{% extends "base.html" %}

{% block content %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Roboto+Serif:wght@400;500&display=swap">
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Merriweather:wght@400;500;700&display=swap"
  rel="stylesheet">

<style>
  /* Checkout Button Styling */
  #checkout-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
    background: linear-gradient(135deg, #b83232 0%, #8b1e1e 100%);
    color: white;
    border: none;
    border-radius: 16px;
    padding: 0;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(184, 50, 50, 0.4);
    transition: all 0.3s ease;
    min-width: 180px;
    left: 50%;
transform: translateX(-50%);
  }

  #checkout-btn:hover:not(:disabled) {
    transform: translateY(-4px);
    box-shadow: 0 12px 35px rgba(184, 50, 50, 0.5);
  }

  #checkout-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: linear-gradient(135deg, #999 0%, #777 100%);
  }

  .checkout-btn-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    padding: 16px 20px;
  }

  /* Checkout Button Styling */
#checkout-btn {
  position: fixed;
  bottom: 20px;
  z-index: 1000;
  background: linear-gradient(135deg, #b83232 0%, #8b1e1e 100%);
  color: white;
  border: none;
  border-radius: 16px;
  padding: 0;
  cursor: pointer;
  box-shadow: 0 8px 25px rgba(184, 50, 50, 0.4);
  transition: all 0.3s ease;
  min-width: 180px;
}

/* Desktop - Stack buttons vertically on right side */
@media (min-width: 1025px) {
  #checkout-btn {
    right: 20px;
    left: auto;
    transform: none;
    bottom: 100px; /* Position above delivery button */
  }
  
  .delivery-widget {
    bottom: 20px;
    right: 20px;
  }
}

/* Tablet - Stack buttons with adjusted spacing */
@media (min-width: 769px) and (max-width: 1024px) {
  #checkout-btn {
    right: 20px;
    left: auto;
    transform: none;
    bottom: 90px; /* Position above delivery button */
    min-width: 170px;
  }
  
  .delivery-widget {
    bottom: 15px;
    right: 15px;
  }
}

/* Mobile - Side by side at bottom */
@media (max-width: 768px) {
  #checkout-btn {
    bottom: 15px;
    right: 90px; /* Position left of delivery button */
    left: auto;
    transform: none;
    min-width: 160px;
  }
  
  .delivery-widget {
    bottom: 15px;
    right: 15px;
  }
  
  .delivery-toggle {
    padding: 10px;
    width: 48px;
    justify-content: center;
  }
  
  .delivery-toggle span:not(.icon) {
    display: none;
  }
}

/* Small mobile devices - Adjust spacing */
@media (max-width: 480px) {
  #checkout-btn {
    bottom: 12px;
    right: 70px; /* Closer to delivery button */
    min-width: 140px;
  }
  
  .delivery-widget {
    bottom: 12px;
    right: 12px;
  }
  
  .delivery-toggle {
    padding: 8px;
    width: 44px;
  }
}

/* Very small screens - Stack vertically */
@media (max-width: 360px) {
  #checkout-btn {
    right: 50%;
    transform: translateX(50%);
    bottom: 70px; /* Above delivery button */
    min-width: 140px;
  }
  
  .delivery-widget {
    bottom: 12px;
    right: 50%;
    transform: translateX(50%);
  }
  
  .delivery-toggle {
    padding: 8px 16px;
    width: auto;
  }
  
  .delivery-toggle span:not(.icon) {
    display: inline;
  }
}

#checkout-btn:hover:not(:disabled) {
  transform: translateY(-4px);
  box-shadow: 0 12px 35px rgba(184, 50, 50, 0.5);
}

#checkout-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  background: linear-gradient(135deg, #999 0%, #777 100%);
}

/* Ensure hover transform works correctly for different positions */
@media (min-width: 769px) {
  #checkout-btn:hover:not(:disabled) {
    transform: translateY(-4px);
  }
}

@media (max-width: 768px) and (min-width: 361px) {
  #checkout-btn:hover:not(:disabled) {
    transform: translateY(-4px);
  }
}

@media (max-width: 360px) {
  #checkout-btn:hover:not(:disabled) {
    transform: translateX(50%) translateY(-4px);
  }
}

.checkout-btn-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  padding: 16px 20px;
}

/* Tree Badge - Top Section */
.tree-badge {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  margin-bottom: 12px;
  width: 100%;
}

#cart-count {
  font-size: 28px;
  font-weight: 800;
  color: #fff;
  line-height: 1;
}

.tree-badge span:last-child {
  font-size: 11px;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
}

/* Checkout Text - Bottom Section */
#checkout-btn > .checkout-btn-container > span:last-child {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 16px;
  font-weight: 700;
}

#checkout-btn .emoji {
  font-size: 20px;
}

/* Responsive Design Updates */
@media (max-width: 768px) {
  .checkout-btn-container {
    padding: 14px 18px;
  }
  .select-indicator {
            width: 24px;
            height: 24px;
            font-size: 14px;
            top: 8px;
            right: 8px;
        }

  #cart-count {
    font-size: 24px;
  }

  .tree-badge span:last-child {
    font-size: 10px;
  }

  #checkout-btn > .checkout-btn-container > span:last-child {
    font-size: 14px;
  }

  #checkout-btn .emoji {
    font-size: 18px;
  }
}

@media (max-width: 480px) {
  .checkout-btn-container {
    padding: 12px 16px;
    gap: 0;
  }

  .tree-badge {
    padding-bottom: 10px;
    margin-bottom: 10px;
  }

  #cart-count {
    font-size: 22px;
  }

  .tree-badge span:last-child {
    font-size: 9px;
  }

  #checkout-btn > .checkout-btn-container > span:last-child {
    font-size: 13px;
    gap: 6px;
  }

  #checkout-btn .emoji {
    font-size: 16px;
  }
}

/* Ensure delivery modal doesn't overlap with checkout button */
@media (min-width: 769px) {
  .delivery-modal {
    bottom: 60px;
    right: 0;
  }
}

@media (max-width: 768px) {
  .delivery-modal {
    bottom: 60px;
    right: 0;
  }
}
  /* Tree Badge - Top Section */
  .tree-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    margin-bottom: 12px;
    width: 100%;
  }

  #cart-count {
    font-size: 28px;
    font-weight: 800;
    color: #fff;
    line-height: 1;
  }

  .tree-badge span:last-child {
    font-size: 11px;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
  }

  /* Checkout Text - Bottom Section */
  #checkout-btn > .checkout-btn-container > span:last-child {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 16px;
    font-weight: 700;
  }

  #checkout-btn .emoji {
    font-size: 20px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    #checkout-btn {
      bottom: 15px;
      right: 15px;
      min-width: 160px;
    }

    .checkout-btn-container {
      padding: 14px 18px;
    }

    #cart-count {
      font-size: 24px;
    }

    .tree-badge span:last-child {
      font-size: 10px;
    }

    #checkout-btn > .checkout-btn-container > span:last-child {
      font-size: 14px;
    }

    #checkout-btn .emoji {
      font-size: 18px;
    }
  }

  @media (max-width: 480px) {


    .select-indicator {
            width: 22px;
            height: 22px;
            font-size: 12px;
        }

    #checkout-btn {
      bottom: 12px;
      right: 50%;
      transform: translateX(50%);
      min-width: 140px;
    }

    .checkout-btn-container {
      padding: 12px 16px;
      gap: 0;
    }

    .tree-badge {
      padding-bottom: 10px;
      margin-bottom: 10px;
    }

    #cart-count {
      font-size: 22px;
    }

    .tree-badge span:last-child {
      font-size: 9px;
    }

    #checkout-btn > .checkout-btn-container > span:last-child {
      font-size: 13px;
      gap: 6px;
    }

    #checkout-btn .emoji {
      font-size: 16px;
    }
  }

  /* Category Header Improvements */
  .category-header {
    margin-bottom: 20px;
  }

  .category-menu {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: flex-start;
  }

  .category-btn {
    padding: 10px 18px;
    border: 2px solid #e0c497;
    background: white;
    color: #5a3d1a;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 14px;
    text-decoration: none;
    display: inline-block;
  }

  .category-btn:hover {
    background: #f5f0e8;
    border-color: #b83232;
    color: #b83232;
    transform: translateY(-2px);
  }

  .category-btn.active {
    background: linear-gradient(135deg, #b83232 0%, #8b1e1e 100%);
    color: white;
    border-color: #b83232;
  }

  @media (max-width: 768px) {
    .category-menu {
      gap: 6px;
    }

    .category-btn {
      padding: 8px 14px;
      font-size: 13px;
    }
  }

  @media (max-width: 480px) {
    .category-menu {
      gap: 5px;
    }

    .category-btn {
      padding: 7px 12px;
      font-size: 12px;
    }
  }





    .product-card.selected {
    border: 2px solid #1a5a2d;
    box-shadow: 0 4px 12px rgba(26, 90, 45, 0.3);
    transform: translateY(-2px);
    transition: all 0.3s ease;
}

.product-card.selected .add-btn {
    background: #1a5a2d;
}

.select-indicator {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: #1a5a2d;
    color: white;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    z-index: 2;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.product-card.selected .select-indicator {
    display: flex;
}

/* For gallery cards if you have them */
.gallery-card .select-indicator {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: #1a5a2d;
    color: white;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    z-index: 2;
}

.gallery-card.selected .select-indicator {
    display: flex;
}
</style>

{% endblock %}

<body>
  <div class="app-container">
    <aside id="catalog-panel" role="complementary" aria-label="Product catalog">
      <h2 data-translate="catalog.title">🎁 Toy Catalog - {{ product_type }}</h2>

      <!-- Category header with buttons -->
      <div class="category-header">
        <div class="category-menu" role="navigation" aria-label="Product categories">
          <button class="category-btn active" data-category="all" data-translate="category.all">All Toys</button>
          <button class="category-btn" data-category="small" data-translate="category.small">Small</button>
          <button class="category-btn" data-category="large" data-translate="category.large">Large</button>
          <a href="{{ url_for('home') }}#offers" class="category-btn" data-translate="category.offers_section">
            Հատուկ առաջարկներ
          </a>
        </div>
      </div>

      <div class="product-grid" role="list"></div>
    </aside>

    <main id="canvas-container" role="main">
      <!-- your canvas or tree rendering here -->
    </main>
  </div>

  <!-- Fixed Checkout Button -->
  <button id="checkout-btn" disabled data-translate-aria="checkout.disabled">
    <div class="checkout-btn-container">
      <!-- Tree badge - Top section -->
      <div class="tree-badge" role="status" aria-live="polite" aria-atomic="true">
        <span id="cart-count">0</span>
        <span data-translate="cert.badge">toys on tree</span>
      </div>
      <!-- Submit button text - Bottom section -->
      <span>
        <span class="emoji">🎅</span>
        <span id="checkout-text" data-translate="checkout.button">Send to Santa</span>
      </span>
    </div>
  </button>

  <!-- Success Overlay -->
  <div id="success-overlay" class="modal-overlay" role="dialog" aria-labelledby="success-title" aria-modal="true">
    <div class="order-paper-card"
      style="max-width:520px;text-align:center;background: #fffdf5; border: 2px solid #e0c497; border-radius: 16px; padding: 28px; box-shadow: 0 0 20px rgba(255,215,160,0.4); font-family: 'Great Vibes', cursive; color:#5a3d1a;">
      <h3 id="success-title" style="font-size: 28px; color:#b83232;" data-translate="success.title">💌 Letter Sent to
        Santa!</h3>
      <p style="font-family: 'Georgia', serif; font-size: 16px; line-height: 1.6; color:#5a3d1a; margin-top: 12px;"
        data-translate="success.message">
        Your heartfelt Christmas wish has just fluttered across the snowy skies to the North Pole! 🎄 Santa's elves are
        already wrapping your chosen toys with ribbons and magic dust. Thank you for keeping the Christmas spirit alive!
        🌟
      </p>
      <p style="font-family: 'Great Vibes', cursive; font-size: 22px; margin-top: 14px; color:#b83232;"
        data-translate="success.signature">
        ✨ With love and festive cheer,<br>Santa's Workshop 🎅
      </p>
      <button class="close-btn" id="close-success"
        style="margin-top:18px;display:inline-block;background:#b83232;color:white;padding:10px 22px;border-radius:24px;border:none;font-family:'Georgia',serif;font-size:15px;cursor:pointer;transition:0.3s;"
        data-translate="success.continue">
        Continue Shopping 🎁
      </button>
    </div>
  </div>

  <!-- Order Modal -->
  <div id="order-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="paper-title">
    <div class="order-paper-card" role="document">
      <!-- Fixed Header Section -->
      <div class="paper-header">
        <div>
          <div class="paper-title" style="font-family:'Great Vibes', cursive; font-size:30px; color:#b83232;"
            data-translate="order.title">
            ✉️ Letter to Santa — Your Christmas Wishes
          </div>
          <div class="paper-sub" style="font-size:15px; color:#7a5a3a;" data-translate="order.subtitle">
            Let's make sure Santa gets your favorite toys right!
          </div>
          <div style="text-align:right;">
            <div style="font-size:13px;color:#7a5a3a;" data-translate="order.preview">Order Preview</div>
            <div style="font-weight:700;color:var(--festive-green);font-size:18px" id="modal-items-count">0 items</div>
          </div>
        </div>
      </div>

      <!-- Scrollable Content Area -->
      <div class="scrollable-content" style="flex: 1; overflow-y: auto; min-height: 0;">

        <!-- Order List with Horizontal Scrolling -->
        <div class="order-list-container" style="margin-bottom: 16px;">
          <div class="order-list" id="order-list"></div>
        </div>

        <!-- Customer Form -->
        <div class="paper-footer" style="border-top:1px dashed #e0c497;padding-top:12px;">
          <div class="paper-total" style="font-weight:bold;font-size:17px; margin-bottom: 12px;">
            <span data-translate="order.total">Total:</span> <span id="paper-total" style="color:#b83232;">0.00֏</span>
          </div>
          <form id="order-form" style="width:100%; display:flex; flex-direction:column; gap:10px;">
            <input type="text" id="customer-name" placeholder="Your Name" required data-translate="order.form.name">
            <input type="email" id="customer-email" placeholder="Your Email" required data-translate="order.form.email">
            <input type="text" id="customer-phone" placeholder="Your Phone" required data-translate="order.form.phone">
            <div id="delivery-message" style="margin-top:6px; color:#b83232; font-size:13px;"
            data-translate="delivery.message">
            Be sure to specify the delivery address.
          </div>
            <textarea id="santa-message" placeholder="Your Message to Santa" required
              data-translate="order.form.message"></textarea>

            <!-- 🚚 Delivery Options -->
            <div class="delivery-section" style="border-top:1px dashed #e0c497; padding-top:12px;">
              <div style="font-weight:bold; margin-bottom:6px;" data-translate="delivery.title">🚚 Delivery Options:
              </div>

              <label style="display:flex; align-items:center; gap:8px;">
                <input type="radio" name="delivery" value="0" data-label="Free delivery in Yerevan center" checked>
                <span data-translate="delivery.option.center">Free delivery in Yerevan center</span>
              </label>

              <label style="display:flex; align-items:center; gap:8px;">
                <input type="radio" name="delivery" value="2000" data-label="Outside Yerevan center - 2000 AMD">
                <span data-translate="delivery.option.outside">Outside Yerevan center - 2000 AMD</span>
              </label>

              <label style="display:flex; align-items:center; gap:8px;">
                <input type="radio" name="delivery" value="0" data-label='Regions via "HayPost"'>
                <span data-translate="delivery.option.regions">Regions via "HayPost" (Delivery to all regions of
                  Armenia)</span>
              </label>

              <label style="display:flex; align-items:center; gap:8px;">
                <input type="radio" name="delivery" value="custom" data-label="Your suggested delivery method">
                <span data-translate="delivery.option.custom">Your suggested delivery method (Throughout Armenia)</span>
              </label>

              <input type="text" id="delivery-address" placeholder="Delivery Address" style="display:none;"
                data-translate="delivery.address">
            </div>


            <div class="paper-actions" style="display:flex; justify-content:flex-end; gap:12px; margin-top:8px;">
              <button type="button" class="btn-secondary" id="paper-cancel"
                style="background:#e4d4b7;color:#5a3d1a;border:none;border-radius:20px;padding:8px 16px;font-size:14px;cursor:pointer;transition:0.3s;"
                data-translate="order.buttons.back">
                Back to Shop 🛒
              </button>
              <button type="submit" class="btn-primary" id="paper-confirm"
                style="background:#b83232;color:white;border:none;border-radius:20px;padding:8px 16px;font-size:14px;cursor:pointer;transition:0.3s;"
                data-translate="order.buttons.send">
                Send to Santa ✨
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Modal -->
  <div id="product-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="product-modal-title">
    <div class="paper-card" role="document">
      <div class="gallery">
        <div class="gallery-main" id="gallery-main">
          <button type="button" class="nav-btn" id="gallery-prev" data-translate-aria="product.gallery.prev"
            style="position:absolute; left:10px; top:50%; transform:translateY(-50%);">◀</button>
          <img id="gallery-image" src="" alt="Product large view">
          <button type="button" class="nav-btn" id="gallery-next" data-translate-aria="product.gallery.next"
            style="position:absolute; right:10px; top:50%; transform:translateY(-50%);">▶</button>
        </div>
        <div class="gallery-thumbs" id="gallery-thumbs" data-translate-aria="product.gallery.thumbs"></div>
      </div>
      <div class="gallery-right" style="display:flex; flex-direction:column;">
        <div class="product-details">
          <h3 id="product-modal-title" data-translate="product.modal.title">Toy Name</h3>
          <div class="product-price" id="product-modal-price" data-translate="product.modal.price">0 ֏</div>
          <p id="product-modal-shape" data-translate="product.modal.shape">Product shape.</p>
          <p id="product-modal-description" data-translate="product.modal.description">Product description.</p>
          <p id="product-modal-public-description" data-translate="product.modal.public_description">Product public
            description.</p>
        </div>

        <div style="margin-top:auto;display:flex;gap:8px;">
          <button class="add-btn" id="modal-add-btn" data-translate="product.modal.add"><span class="icon">🎁</span>Add
            to Tree</button>
          <button class="btn-secondary" id="modal-close" data-translate="product.modal.close">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div id="announcements" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <!-- GSAP Core -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <!-- MotionPath Plugin -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/MotionPathPlugin.min.js"></script>

  <script src="{{ url_for('static', filename='js/api.js') }}"></script>
  <script src="{{ url_for('static', filename='js/scene.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

{% endblock %}