{% extends "base.html" %}

{% block title %}
<span data-translate="product_types.title">’è’•’Ω’°’Ø’∂’•÷Ä ‚Äî ’ì’°’µ’ø’µ’° ’Ü’æ’•÷Ä-’¶’°÷Ä’§’•÷Ä</span>
{% endblock %}

{% block content %}

<head>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow-x: hidden;
            min-height: 100vh;
            color: white;
        }

        .global-animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            background: linear-gradient(135deg, #0f3d1f 0%, #1a5a2d 50%, #0f3d1f 100%);
        }

        /* Make sure header & footer stay on top */
        header,
        footer {
            position: relative;
            /* usually already relative */
            z-index: 10;
            /* ABOVE animated background */
        }

        /* Sections except header/footer stay transparent */
        section {
            background: transparent !important;
            position: relative;
            z-index: 5;
            /* between header/footer and background */
        }

        /* Snowflakes */
        @keyframes snowfall {
            0% {
                transform: translateY(-10vh);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        .snowflake {
            position: fixed;
            top: -10vh;
            color: white;
            font-size: 1.5em;
            opacity: 0.8;
            pointer-events: none;
            z-index: 1;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        }

        /* Toys layer */
        .animated-toys-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
            pointer-events: none;
        }

        .animated-toy {
            position: absolute;
            width: 180px;
            opacity: 0.1;
            filter: blur(1.5px) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
            will-change: transform;
        }

        @keyframes randomWalk {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(0.9);
                opacity: 0.25;
            }

            25% {
                transform: translate(100px, 150px) rotate(45deg) scale(1.05);
                opacity: 0.4;
            }

            50% {
                transform: translate(-80px, 100px) rotate(-30deg) scale(1);
                opacity: 0.3;
            }

            75% {
                transform: translate(120px, -50px) rotate(90deg) scale(1.1);
                opacity: 0.35;
            }

            100% {
                transform: translate(0, 0) rotate(0deg) scale(0.9);
                opacity: 0.25;
            }
        }

        .animated-toy:nth-child(1) {
            top: 10%;
            left: 8%;
            animation: randomWalk 12s ease-in-out infinite;
        }

        .animated-toy:nth-child(2) {
            top: 20%;
            left: 78%;
            animation: randomWalk 15s ease-in-out infinite reverse;
        }

        .animated-toy:nth-child(3) {
            top: 50%;
            left: 25%;
            animation: randomWalk 13s ease-in-out infinite;
        }

        .animated-toy:nth-child(4) {
            top: 62%;
            left: 82%;
            animation: randomWalk 14s ease-in-out infinite reverse;
        }

        .animated-toy:nth-child(5) {
            top: 32%;
            left: 48%;
            animation: randomWalk 16s ease-in-out infinite;
        }


        /* Hero */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
        }

        .hero-content {
            z-index: 10;
            padding: 40px;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            margin-bottom: 20px;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .hero-subtitle {
            font-size: clamp(1rem, 3vw, 1.5rem);
            color: rgba(255, 255, 255, 0.9);
        }

        .snowglobe {
            display: inline-block;
            font-size: 15rem;
            margin: 20px 0;
            animation: bounce 3s infinite ease-in-out;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        /* Product section */
        .products-section {
            padding: 100px 20px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .section-header h2 {
            font-size: 2.5rem;
            color: white;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .image-wrap {
            width: 100%;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #eee;
        }

        .image-wrap img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .card-body {
            padding: 20px;
        }

        .card-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: black;
        }

        .card-desc {
            color: #555;
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            color: white;
            opacity: 0.8;
            padding: 40px;
        }
    </style>
</head>

<body>
    <!-- Fixed background toys & snow -->
    <div class="global-animated-bg">
        <div class="animated-toys-container">
            <img src="{{ url_for('static', filename='images/animated_toys/1.png') }}" class="animated-toy" alt="Toy 1">
            <img src="{{ url_for('static', filename='images/animated_toys/2.png') }}" class="animated-toy" alt="Toy 2">
            <img src="{{ url_for('static', filename='images/animated_toys/3.png') }}" class="animated-toy" alt="Toy 3">
            <img src="{{ url_for('static', filename='images/animated_toys/4.png') }}" class="animated-toy" alt="Toy 4">
            <img src="{{ url_for('static', filename='images/animated_toys/5.png') }}" class="animated-toy" alt="Toy 5">
        </div>
        <div id="snowflakes-container"></div>
    </div>

    <!-- Hero -->
    <section class="hero">
        <div class="hero-content">
            <div class="snowglobe">üéÑ</div>
            <h1>’ì’°’µ’ø’µ’° ’Ü’æ’•÷Ä-’¶’°÷Ä’§’•÷Ä</h1>
            <p class="hero-subtitle">‘≤’∂’°’Ø’°’∂ ÷É’°’µ’ø’´÷Å ’∫’°’ø÷Ä’°’Ω’ø’æ’°’Æ ’ø’∏’∂’°’Ø’°’∂ ’¶’°÷Ä’§’•÷Ä’ù ’ø’∫’°’£÷Ä’æ’°’Æ ’∫’°’ø’Ø’•÷Ä’∂’•÷Ä’∏’æ</p>
        </div>
    </section>

    <!-- Products -->
    <section class="products-section">
        <div class="container">
            <div class="section-header">
                <h2>üéÅ ’Ñ’•÷Ä ‘ø’∏’¨’•’Ø÷Å’´’°</h2>
            </div>
            <div id="grid" class="grid">
                <div class="empty-state">‘≤’•’º’∂’∏÷Ç’¥... ‚è≥</div>
            </div>
        </div>
    </section>
</body>
{% endblock %}

{% block scripts %}
<script>
    // Snow animation
    function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.classList.add('snowflake');
        snowflake.textContent = ['‚ùÑÔ∏è', '‚ú®', '‚õÑ'][Math.floor(Math.random() * 3)];
        snowflake.style.left = Math.random() * window.innerWidth + 'px';
        snowflake.style.animation = `snowfall ${5 + Math.random() * 5}s linear forwards`;
        document.getElementById('snowflakes-container').appendChild(snowflake);
        setTimeout(() => snowflake.remove(), 10000);
    }
    setInterval(createSnowflake, 400);

    // Dynamic products
    const BASE_URL = (() => {
    const path = window.location.pathname;
    if (path.startsWith('/mandarin')) {
        return '/mandarin';
    }
    return '';
})();
    const API_LIST = "{{ API_LIST or '/api/product-types' }}";
    const IMAGE_PREFIX = "{{ IMAGE_PREFIX or '/static/' }}";
    const SHOP_URL = "{{ SHOP_URL or '/shop' }}";
    const grid = document.getElementById("grid");

    async function fetchAndRender() {
        grid.innerHTML = `<div class="empty-state">‘≤’•’º’∂’∏÷Ç’¥... ‚è≥</div>`;
       try {
            const res = await fetch("{{BASE_PREFIX}}"+`${API_LIST}`);
            const arr = await res.json();
            grid.innerHTML = arr.length
                ? arr.map(pt => `
                    <div class="card">
                        <a href={{BASE_PREFIX}}"${SHOP_URL}?type=${encodeURIComponent(pt.type)}" style="text-decoration:none;color:inherit;">
                            <div class="image-wrap">
                                <img src="${pt.image_url?.startsWith('http') ? pt.image_url : IMAGE_PREFIX + pt.image_url}" alt="${pt.title_hy || ''}">
                            </div>
                            <div class="card-body">
                                <div class="card-title">${pt.title_hy || pt.title_en || pt.title_ru}</div>
                                <div class="card-desc">${pt.description_hy || ''}</div>
                            </div>
                        </a>
                    </div>
                `).join('')
                : `<div class="empty-state">’è’•’Ω’°’Ø’∂’•÷Ä ’π’•’∂ ’£’ø’∂’æ’•’¨ üéÑ</div>`;
        } catch (err) {
            grid.innerHTML = `<div class="empty-state">‚ö†Ô∏è ’â’∞’°’ª’∏’≤’æ’•÷Å ’¢’•’º’∂’•’¨</div>`;
        }
    }
    document.addEventListener('DOMContentLoaded', fetchAndRender);
</script>
{% endblock %}