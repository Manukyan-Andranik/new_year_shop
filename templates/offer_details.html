{% extends "base.html" %}

{% block title %}
{{ offer_title }} ‚Äî ’ì’°’µ’ø’µ’° ’Ü’æ’•÷Ä-’¶’°÷Ä’§’•÷Ä
{% endblock %}

{% block content %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        overflow-x: hidden;
        min-height: 100vh;
        color: white;
        position: relative;
    }

    .global-animated-bg {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0f3d1f 0%, #1a5a2d 50%, #0f3d1f 100%);
        z-index: 0;
        pointer-events: none;
    }

    .animated-toys-container,
    #snowflakes-container {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
    }

    .animated-toy {
        position: absolute;
        width: 180px;
        opacity: 0.1;
        animation: randomWalk 14s ease-in-out infinite;
    }

    @keyframes randomWalk {
        0% {
            transform: translate(0, 0) rotate(0deg);
        }

        50% {
            transform: translate(60px, 80px) rotate(30deg);
        }

        100% {
            transform: translate(0, 0) rotate(0deg);
        }
    }

    .offer-details-container {
        position: relative;
        z-index: 10;
        max-width: 1400px;
        margin: 120px auto 60px;
        padding: 40px 20px;
    }

    .back-btn {
        display: inline-block;
        background: rgba(255, 255, 255, 0.95);
        color: #1a5a2d;
        padding: 12px 24px;
        border-radius: 25px;
        text-decoration: none;
        margin-bottom: 30px;
        font-weight: 600;
        transition: 0.3s;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .back-btn:hover {
        transform: translateX(-5px);
    }

    .offer-header {
        background: rgba(255, 255, 255, 0.97);
        padding: 30px;
        border-radius: 20px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    }

    .offer-title {
        font-size: clamp(2rem, 5vw, 3rem);
        color: #1a5a2d;
        font-weight: 800;
        margin-bottom: 15px;
    }

    .offer-description {
        white-space: pre-wrap;
        line-height: 1.8;
        color: #1f2937;
        font-size: 1.05rem;
    }

    .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }

    /* Product Catalog Section */
    .catalog-section {
        background: rgba(255, 255, 255, 0.97);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        max-height: 900px;
        overflow-y: auto;
    }

    .catalog-title {
        font-size: 1.6rem;
        color: #1a5a2d;
        font-weight: 700;
        margin-bottom: 20px;
        text-align: center;
    }

    .product-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        width: 100%;
    }

    .product-card {
        background: rgba(255, 255, 255, 0.65);
        border-radius: 12px;
        padding: 10px;
        cursor: pointer;
        transition: transform .22s cubic-bezier(.2, .9, .3, 1), box-shadow .22s, border-color .22s;
        position: relative;
        border: 2px solid rgba(0, 0, 0, 0.05);
        box-shadow: 0 4px 12px rgba(10, 20, 40, 0.06);
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .product-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(10, 20, 40, 0.12);
    }

    .product-card.selected {
        border-color: #1a5a2d;
        box-shadow: 0 6px 20px rgba(26, 90, 45, 0.3);
        background: rgba(26, 90, 45, 0.1);
    }

    .card-top {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        width: 100%;
    }

    .product-image {
        width: 100%;
        max-width: 180px;
        height: 180px;
        object-fit: contain;
        border-radius: 10px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.95), rgba(245, 245, 245, 1));
        padding: 8px;
        border: 1px solid rgba(0, 0, 0, 0.03);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .product-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
        width: 100%;
    }

    .product-name {
        font-weight: 800;
        font-size: 14px;
        color: #222;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .product-price {
        color: #1a5a2d;
        font-weight: 900;
        font-size: 13px;
    }

    .select-indicator {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: #1a5a2d;
        color: white;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 14px;
    }

    .product-card.selected .select-indicator {
        display: flex;
    }

    /* Image Gallery for christmas_together and seasons_best */
    .image-gallery {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .gallery-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 12px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s ease;
    }

    .gallery-image:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .gallery-image.selected {
        position: relative;
        /* needed for the pseudo-element */
        border: 5px solid #1a5a2d;
        /* green border */
        box-shadow: 0 6px 20px rgba(26, 90, 45, 0.4);
        opacity: 0.7;
        /* slightly transparent */
        border-radius: 8px;
        /* optional: rounded corners */
    }

    .gallery-image.selected::after {
        content: "‚úì";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 2rem;
        /* adjust size */
        color: #1a5a2d;
        font-weight: bold;
        pointer-events: none;
        /* allows clicks to pass through */
    }


    /* Order Form Section */
    .form-section {
        background: rgba(255, 255, 255, 0.97);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        max-height: 900px;
        overflow-y: auto;
    }

    .form-title {
        font-size: 1.6rem;
        color: #1a5a2d;
        font-weight: 700;
        margin-bottom: 25px;
        text-align: center;
    }

    .form-group {
        margin-bottom: 18px;
    }

    .form-label {
        display: block;
        font-size: 0.95rem;
        color: #374151;
        margin-bottom: 6px;
        font-weight: 600;
    }

    .required {
        color: #dc2626;
    }

    .form-input,
    .form-textarea,
    .form-select {
        width: 100%;
        padding: 12px 14px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background: white;
        color: #1f2937;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
        outline: none;
        border-color: #1a5a2d;
        box-shadow: 0 0 0 3px rgba(26, 90, 45, 0.1);
    }

    .form-textarea {
        min-height: 100px;
        resize: vertical;
        font-family: inherit;
    }

    .form-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 15px;
    }

    .form-checkbox input {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .form-checkbox label {
        cursor: pointer;
        color: #374151;
        font-weight: 600;
    }

    .names-container {
        display: none;
        margin-top: 15px;
    }

    .names-container.show {
        display: block;
    }

    .name-input-group {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
    }

    .name-input-group input {
        flex: 1;
    }

    .add-name-btn,
    .remove-name-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .add-name-btn {
        background: #1a5a2d;
        color: white;
        width: 100%;
        margin-top: 10px;
    }

    .add-name-btn:hover {
        background: #0f3d1f;
    }

    .remove-name-btn {
        background: #dc2626;
        color: white;
    }

    .remove-name-btn:hover {
        background: #b91c1c;
    }

    .submit-btn {
        background: linear-gradient(135deg, #1a5a2d 0%, #0f3d1f 100%);
        color: white;
        border: none;
        padding: 16px;
        width: 100%;
        border-radius: 10px;
        font-weight: 700;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(26, 90, 45, 0.3);
        margin-top: 20px;
    }

    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(26, 90, 45, 0.4);
    }

    .submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .message {
        padding: 14px;
        border-radius: 8px;
        margin-bottom: 15px;
        font-weight: 600;
        text-align: center;
        display: none;
    }

    .message.success {
        background: #d1fae5;
        color: #065f46;
        border: 2px solid #10b981;
    }

    .message.error {
        background: #fee2e2;
        color: #991b1b;
        border: 2px solid #ef4444;
    }

    .message.show {
        display: block;
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .selected-products-list {
        background: rgba(26, 90, 45, 0.05);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid rgba(26, 90, 45, 0.2);
    }

    .selected-products-title {
        font-weight: 700;
        color: #1a5a2d;
        margin-bottom: 10px;
    }

    .selected-product-item {
        display: flex;
        justify-content: space-between;
        padding: 8px;
        background: white;
        border-radius: 6px;
        margin-bottom: 8px;
        font-size: 0.9rem;
        color: var(--festive-green);
    }

    @media (max-width: 1024px) {
        .content-grid {
            grid-template-columns: 1fr;
        }

        .catalog-section,
        .form-section {
            max-height: none;
        }
    }

    @media (max-width: 768px) {
        .product-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .product-image {
            max-width: 140px;
            height: 140px;
        }

        .image-gallery {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="global-animated-bg">
    <div class="animated-toys-container">
        <img src="{{ url_for('static', filename='images/animated_toys/1.png') }}" class="animated-toy" alt="">
        <img src="{{ url_for('static', filename='images/animated_toys/2.png') }}" class="animated-toy" alt="">
        <img src="{{ url_for('static', filename='images/animated_toys/3.png') }}" class="animated-toy" alt="">
    </div>
    <div id="snowflakes-container"></div>
</div>

<div class="offer-details-container">
    <a href="{{ url_for('home') }}#offers" class="back-btn">‚Üê ’é’•÷Ä’°’§’°’º’∂’°’¨</a>

    <div class="offer-header">
        <h1 id="offerTitle" class="offer-title"></h1>
        <p id="offerDescription" class="offer-description"></p>
    </div>

    <div class="content-grid">
        <!-- Left: Product Catalog or Image Gallery -->
        <div class="catalog-section">
            <h2 data-translate="offer.select_products" class="catalog-title" id="catalogTitle">‘∏’∂’ø÷Ä’•÷Ñ ’°’∫÷Ä’°’∂÷Ñ’∂’•÷Ä</h2>
            <div id="productGrid" class="product-grid"></div>
            <div id="imageGallery" class="image-gallery" style="display: none;"></div>
        </div>

        <!-- Right: Order Form -->
        <div class="form-section">
            <h2 class="form-title">üìù ’ä’°’ø’æ’´÷Ä’•’¨ ’∞’´’¥’°</h2>
            <div class="message" id="formMessage"></div>

            <div id="selectedProductsList" class="selected-products-list" style="display: none;">
                <div class="selected-products-title">‘∏’∂’ø÷Ä’æ’°’Æ ’°’∫÷Ä’°’∂÷Ñ’∂’•÷Ä:</div>
                <div id="selectedProductsContent"></div>
            </div>

            <form id="orderForm"></form>
        </div>
    </div>
</div>
<script>
    
    const BASE_PREFIX = "{{ BASE_PREFIX }}";
    const currentLang = window.translationManager ? window.translationManager.currentLanguage : 'hy';

    const offerData = {
        my_classroom: {
            type: 'products',
            fields: 'my_classroom',
            translations: {
                hy: {
                    title: 'üéì ‘ª’¥ ’§’°’Ω’°÷Ä’°’∂',
                    description: `’Ü’æ’´÷Ä’•÷Ñ ’±’•÷Ä ’°’∑’°’Ø’•÷Ä’ø’∂’•÷Ä’´’∂ ’Ø’°’¥ ’∏÷Ç’Ω’°’∂’∏’≤’∂’•÷Ä’´’∂ ÷É’∏÷Ñ÷Ä’´’Ø, ’¢’°’µ÷Å ’°’∂’Ø’•’≤’Æ ’∂’æ’•÷Ä’∂’•÷Ä’ù ’±’•÷Ä ’Ω’´÷Ä’∏’æ ’∫’°’ø÷Ä’°’Ω’ø’æ’°’Æ÷â

’ä’°’ø’æ’´÷Ä’•÷Ñ ’±’•÷Ä ’§’°’Ω’°÷Ä’°’∂’´ ÷Ñ’°’∂’°’Ø’∏’æ ÷á ’Ω’ø’°÷Å’•÷Ñ ’∞’°’ø’∏÷Ç’Ø ’¶’•’≤’π’•÷Ä üéÅ

’ç’° ’∞’´’°’∂’°’¨’´ ’ø’°÷Ä’¢’•÷Ä’°’Ø ’ß ’°’∑’°’Ø’•÷Ä’ø’∂’•÷Ä’´’∂ ’∑’∂’∏÷Ä’∞’°’Ø’°’¨’∏÷Ç’©’µ’∏÷Ç’∂ ’∞’°’µ’ø’∂’•’¨’∏÷Ç, ’ø’∏’∂’°’Ø’°’∂ ’ø÷Ä’°’¥’°’§÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ ’Ω’ø’•’≤’Æ’•’¨’∏÷Ç ÷á ’¥’´’°’Ω’´’∂ ’™’∫’ø’°’¨’∏÷Ç ’∞’°’¥’°÷Ä÷â

’Ö’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’∂’æ’•÷Ä’´ ’∞’°’¥’°÷Ä ’Ø’°÷Ä’∏’≤ ’•÷Ñ ’®’∂’ø÷Ä’•’¨ ’°’º’°’∂’±’´’∂ ÷É’°’©’•’©’°’æ’∏÷Ä’∏÷Ç’¥, ’´’Ω’Ø ’¥’•’∂÷Ñ ’¥’•÷Ä ’Ø’∏’≤’¥’´÷Å ’µ’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’ø’∏’∫÷Ä’°’Ø’´ ’¥’•’ª ’Ø’§’∂’•’∂÷Ñ ÷É’∏÷Ñ÷Ä’´’Ø ’°’∂’°’Ø’∂’Ø’°’¨ ÷á ’ø’∏’∂’°’Ø’°’∂ ’¥’°’≤’©’°’∂÷Ñ’∂’•÷Ä ’±’•÷Ä ’Ω’°’∂’•÷Ä’´ ’∞’°’¥’°÷Ä ‚ú®`
                },
                en: {
                    title: 'üéì My Classroom',
                    description: `Give your students or classmates small but heartfelt gifts made with love.

Order in quantities for your class and receive special discounts üéÅ

It‚Äôs a wonderful way to thank your students, create a festive atmosphere, and share smiles together.

Each gift can come with individual packaging, and we‚Äôll include a small surprise and a festive wish for every student ‚ú®`
                },
                ru: {
                    title: 'üéì –ú–æ–π –∫–ª–∞—Å—Å',
                    description: `–ü–æ–¥–∞—Ä–∏—Ç–µ —Å–≤–æ–∏–º —É—á–µ–Ω–∏–∫–∞–º –∏–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º –Ω–µ–±–æ–ª—å—à–∏–µ, –Ω–æ –∏—Å–∫—Ä–µ–Ω–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∏, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ —Å –ª—é–±–æ–≤—å—é.

–ó–∞–∫–∞–∂–∏—Ç–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∫–∏–¥–∫–∏ üéÅ

–≠—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å —É—á–µ–Ω–∏–∫–æ–≤, —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –≤–º–µ—Å—Ç–µ —É–ª—ã–±–Ω—É—Ç—å—Å—è.

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é —É–ø–∞–∫–æ–≤–∫—É, –∞ –º—ã –ø–æ–ª–æ–∂–∏–º –≤ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç–∏–∫ –º–∞–ª–µ–Ω—å–∫–∏–π —Å—é—Ä–ø—Ä–∏–∑ –∏ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è ‚ú®`
                }
            }
        },

        corporate: {
            type: 'products',
            fields: 'corporate',
            translations: {
                hy: {
                    title: 'üíº ‘ø’∏÷Ä’∫’∏÷Ä’°’ø’´’æ',
                    description: `’Ü’æ’´÷Ä’•÷Ñ ’±’•÷Ä ’©’´’¥’´’∂ ’ª’•÷Ä’¥ ’¥’©’∂’∏’¨’∏÷Ä’ø ÷á ’ø’∏’∂’°’Ø’°’∂ ’ø÷Ä’°’¥’°’§÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ üí´

‘≥’∂’•÷Ñ ’±’•÷Ä ’°’∑’≠’°’ø’°’Ø’´÷Å’∂’•÷Ä’´ ’Ø’°’¥ ’£’∏÷Ä’Æ’®’∂’Ø’•÷Ä’∂’•÷Ä’´ ’∞’°’¥’°÷Ä ’±’•’º’°’£’∏÷Ä’Æ ÷É’°’µ’ø’• ’≠’°’≤’°’¨’´÷Ñ’∂’•÷Ä’ù ’∏÷Ä’∫’•’Ω ’∑’∂’∏÷Ä’∞’°’Ø’°’¨’∏÷Ç’©’µ’°’∂ ÷á ’∞’∏’£’°’ø’°÷Ä’∏÷Ç’©’µ’°’∂ ’∂’∑’°’∂÷â

‘±’¥÷Ä’°’∫’∂’§’•÷Ñ ’©’´’¥’°’µ’´’∂ ’∏’£’´’∂ ÷á ’¶’°÷Ä’§’°÷Ä’•÷Ñ ’±’•÷Ä ’£÷Ä’°’Ω’•’∂’µ’°’Ø’´ ’ø’∏’∂’°’Æ’°’º’® ’µ’∏÷Ç÷Ä’°’∞’°’ø’∏÷Ç’Ø ÷É’°’µ’ø’• ’≠’°’≤’°’¨’´÷Ñ’∂’•÷Ä’∏’æ÷â

’ä’°’ø’æ’•÷Ä’∂’•÷Ä’® ’Ø’°÷Ä’∏’≤ ’•’∂ ’¨’´’∂’•’¨ ’¥’•÷Ä ’ø’•’Ω’°’Ø’°’∂’∏÷Ç÷Å ’Ø’°’¥ ’±’•÷Ä ’¢÷Ä’•’∂’§’°’µ’´’∂ ’∫’°’ø’Ø’•÷Ä’∂’•÷Ä’∏’æ÷â

’Ñ’•’∂÷Ñ ’Ø÷É’°’©’•’©’°’æ’∏÷Ä’•’∂÷Ñ ’µ’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’∂’æ’•÷Ä ’°’º’°’∂’±’´’∂’ù ’°’æ’•’¨’°÷Å’∂’•’¨’∏’æ ’ø’∏’∂’°’Ø’°’∂ ’¥’°’≤’©’°’∂÷Ñ’∂’•÷Ä ÷á ÷É’∏÷Ñ÷Ä’´’Ø ’°’∂’°’Ø’∂’Ø’°’¨’∂’•÷Ä ’µ’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’ø’∏’∫÷Ä’°’Ø’´ ’¥’•’ª üéÑ`
                },
                en: {
                    title: 'üíº Corporate Gifts',
                    description: `Bring warmth and a festive mood to your team üí´

Give your employees or partners handcrafted wooden ornaments as a token of gratitude and care.

Strengthen team spirit and decorate your office tree with unique wooden ornaments.

Orders can be from our catalog or customized with your brand imagery.

We‚Äôll pack each gift individually, adding festive wishes and small surprises to every bag üéÑ`
                },
                ru: {
                    title: 'üíº –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏',
                    description: `–ü–æ–¥–∞—Ä–∏—Ç–µ —Å–≤–æ–µ–π –∫–æ–º–∞–Ω–¥–µ —Ç–µ–ø–ª–æ –∏ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ üí´

–ü–æ–¥–∞—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∏–ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –∏–≥—Ä—É—à–∫–∏ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ –∑–Ω–∞–∫ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –∏ –∑–∞–±–æ—Ç—ã.

–£–∫—Ä–µ–ø–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—ã–π –¥—É—Ö –∏ —É–∫—Ä–∞—Å—å—Ç–µ –æ—Ñ–∏—Å–Ω—É—é —ë–ª–∫—É —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–º–∏ —É–∫—Ä–∞—à–µ–Ω–∏—è–º–∏.

–ó–∞–∫–∞–∑—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫ –∏–∑ –Ω–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏, —Ç–∞–∫ –∏ —Å –≤–∞—à–∏–º –±—Ä–µ–Ω–¥–∏–Ω–≥–æ–º.

–ú—ã —É–ø–∞–∫—É–µ–º –∫–∞–∂–¥—ã–π –ø–æ–¥–∞—Ä–æ–∫ –æ—Ç–¥–µ–ª—å–Ω–æ, –¥–æ–±–∞–≤–∏–≤ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏ –º–∞–ª–µ–Ω—å–∫–∏–µ —Å—é—Ä–ø—Ä–∏–∑—ã üéÑ`
                }
            }
        },

        special_for_you: {
            type: 'products',
            fields: 'special_for_you',
            translations: {
                hy: {
                    title: 'üíñ ’Ä’°’ø’∏÷Ç’Ø ÷Ñ’•’¶ ’∞’°’¥’°÷Ä',
                    description: `’î’∏ ’°’∂’∏÷Ç’∂’∏’æ ’∞÷Ä’°’∑÷Ñ üíå

‘±’µ’Ω ’¢’°’™’∂’∏÷Ç’¥ ’µ’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’∂’æ’•÷Ä ’Ø’°÷Ä’∏’≤ ’ß ’§’°’º’∂’°’¨ ’¢’°÷Å’°’º’´’Ø’ù ÷Ñ’∏ ’°’∂’∏÷Ç’∂’∏’æ, ’∫’°’ø’¥’∏÷Ç’©’µ’°’¥’¢ ÷á ÷Å’°’∂’Ø’∏÷Ç’©’µ’°’¥’¢÷â

’ä’°’ø’æ’´÷Ä’•÷Ñ ’°’∂’æ’°’∂’°’Ø’°’∂ ÷É’°’µ’ø’• ’≠’°’≤’°’¨’´÷Ñ’∂’•÷Ä ’±’•÷Ä ’¥’ø’•÷Ä’´’¥’∂’•÷Ä’´ ’∞’°’¥’°÷Ä ÷á ’§’°÷Ä’±÷Ä’•÷Ñ ’±’•÷Ä ’∂’æ’•÷Ä’∂’•÷Ä’® ’´’Ω’Ø’°’∫’•’Ω ’°’∂’±’∂’°’Ø’°’∂ ’∏÷Ç ’°’∂’Ø÷Ä’Ø’∂’•’¨’´÷â

’ç’° ’°’µ’∂ ’¥’°’∂÷Ä’∏÷Ç÷Ñ’∂ ’ß, ’∏÷Ä’® ’Ω’∏’æ’∏÷Ä’°’Ø’°’∂ ’∂’æ’•÷Ä’® ’§’°÷Ä’±’∂’∏÷Ç’¥ ’ß ’∞’´’∑’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’ù ’Ω’´÷Ä’∏’æ ’∫’°’ø÷Ä’°’Ω’ø’æ’°’Æ ’∞’•’∂÷Å ÷Ñ’•’¶ ’∞’°’¥’°÷Ä÷â`
                },
                en: {
                    title: 'üíñ Special for You',
                    description: `A personalized miracle üíå

Every gift here can become unique‚Äîwith your name, story, and wishes.

Order personalized wooden ornaments for your loved ones and make your gifts truly personal and unforgettable.

It‚Äôs the little detail that turns an ordinary gift into a cherished memory made with love.`
                },
                ru: {
                    title: 'üíñ –û—Å–æ–±–µ–Ω–Ω—ã–π –¥–ª—è —Ç–µ–±—è',
                    description: `–ß—É–¥–æ —Å —Ç–≤–æ–∏–º –∏–º–µ–Ω–µ–º üíå

–ö–∞–∂–¥—ã–π –ø–æ–¥–∞—Ä–æ–∫ –∑–¥–µ—Å—å –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ‚Äî —Å —Ç–≤–æ–∏–º –∏–º–µ–Ω–µ–º, –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –ø–æ–∂–µ–ª–∞–Ω–∏–µ–º.

–ó–∞–∫–∞–∂–∏—Ç–µ –∏–º–µ–Ω–Ω—ã–µ –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –∏–≥—Ä—É—à–∫–∏ –¥–ª—è —Å–≤–æ–∏—Ö –±–ª–∏–∑–∫–∏—Ö –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ–∏ –ø–æ–¥–∞—Ä–∫–∏ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –ª–∏—á–Ω—ã–º–∏ –∏ –Ω–µ–ø–æ–≤—Ç–æ—Ä–∏–º—ã–º–∏.

–≠—Ç–æ —Ç–∞ –¥–µ—Ç–∞–ª—å, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –æ–±—ã—á–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –≤ –ø–∞–º—è—Ç—å, —Å–æ–∑–¥–∞–Ω–Ω—É—é —Å –ª—é–±–æ–≤—å—é.`
                }
            }
        },

        christmas_together: {
            type: 'images',
            imagesCount: 5,
            folder: 'offers/christmas_together',
            fields: 'christmas_together',
            translations: {
                hy: {
                    title: 'üè° ‘±’¥’°’∂’∏÷Ä’® ’¥’´’°’Ω’´’∂',
                    description: `’è’∏’∂’•÷Ñ ’®’∂’ø’°’∂’´÷Ñ’´ ’∞’•’ø’ù ’¨’´ ’Ω’´÷Ä’∏’æ, ’™’∫’´’ø’∂’•÷Ä’∏’æ ÷á ÷É’°’µ’ø’• ’∞÷Ä’°’∑÷Ñ’∂’•÷Ä’∏’æ ‚ù§Ô∏è

’Ü’æ’´÷Ä’•÷Ñ ’±’•÷Ä ’Ω’´÷Ä’•’¨’´’∂’•÷Ä’´’∂ ÷É’∏÷Ñ÷Ä’´’Ø ’≠’°’≤’°’¨’´÷Ñ’∂’•÷Ä ’Ø’°’¥ ’¶’°÷Ä’§’°÷Ä’•÷Ñ ’®’∂’ø’°’∂’•’Ø’°’∂ ’ø’∏’∂’°’Æ’°’º’® ’¥’•÷Ä ’±’•’º’°’£’∏÷Ä’Æ ’∞’°’æ’°÷Ñ’°’Æ’∏÷Ç’∂’•÷Ä’∏’æ÷â

’Ñ’•÷Ä ’∂’°’≠’°’∫’•’Ω ’®’∂’ø÷Ä’æ’°’Æ ’∞’°’æ’°÷Ñ’°’Æ’∏÷Ç’∂’•÷Ä’´ ’∑’∂’∏÷Ä’∞’´’æ ’§’∏÷Ç÷Ñ ’∞’•’∑’ø’∏÷Ç’©’µ’°’¥’¢ ’Ø’®’∂’ø÷Ä’•÷Ñ ’¥’´ ÷Ñ’°’∂’´ ’£’•’≤’•÷Å’´’Ø ’≠’°’≤’°’¨’´÷Ñ’ù ’∂’°’≠’°’ø’•’Ω’æ’°’Æ ’±’•÷Ä ’®’∂’ø’°’∂’´÷Ñ’´ ’µ’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’°’∂’§’°’¥’´ ’∞’°’¥’°÷Ä÷â

‘±’¥’°’∂’∏÷Ä’® ’¥’´’°’Ω’´’∂’ù ’∏÷Ä’ø’•’≤ ’µ’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’≠’°’≤’°’¨’´÷Ñ ’∫’°’ø’¥’∏÷Ç’¥ ’ß ’±’•÷Ä ’ø’°’∂ ’ª’•÷Ä’¥ ’∫’°’ø’¥’∏÷Ç’©’µ’∏÷Ç’∂’® üåü`
                },
                en: {
                    title: 'üè° Christmas Together',
                    description: `Celebrate with your family‚Äîfull of love, smiles, and wooden magic ‚ù§Ô∏è

Give your loved ones small gifts or decorate your family tree with our handcrafted sets.

With our pre-selected collections, you can easily choose several beautiful ornaments for each family member.

Christmas together‚Äîwhere every ornament tells the warm story of your home üåü`
                },
                ru: {
                    title: 'üè° –ù–æ–≤—ã–π –≥–æ–¥ –≤–º–µ—Å—Ç–µ',
                    description: `–ü—Ä–∞–∑–¥–Ω—É–π—Ç–µ —Å —Å–µ–º—å—ë–π ‚Äî —Å –ª—é–±–æ–≤—å—é, —É–ª—ã–±–∫–∞–º–∏ –∏ –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–º–∏ —á—É–¥–µ—Å–∞–º–∏ ‚ù§Ô∏è

–ü–æ–¥–∞—Ä–∏—Ç–µ –±–ª–∏–∑–∫–∏–º –Ω–µ–±–æ–ª—å—à–∏–µ –∏–≥—Ä—É—à–∫–∏ –∏–ª–∏ —É–∫—Ä–∞—Å—å—Ç–µ —Å–µ–º–µ–π–Ω—É—é —ë–ª–∫—É –Ω–∞—à–∏–º–∏ –Ω–∞–±–æ—Ä–∞–º–∏ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

–ë–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∞—à–∏–º –≥–æ—Ç–æ–≤—ã–º –∫–æ–ª–ª–µ–∫—Ü–∏—è–º –≤—ã –ª–µ–≥–∫–æ –ø–æ–¥–±–µ—Ä—ë—Ç–µ –∫—Ä–∞—Å–∏–≤—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–ª–µ–Ω–∞ —Å–µ–º—å–∏.

–ù–æ–≤—ã–π –≥–æ–¥ –≤–º–µ—Å—Ç–µ ‚Äî –≥–¥–µ –∫–∞–∂–¥–∞—è –∏–≥—Ä—É—à–∫–∞ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—ë–ø–ª—É—é –∏—Å—Ç–æ—Ä–∏—é –≤–∞—à–µ–≥–æ –¥–æ–º–∞ üåü`
                }
            }
        },

        seasons_best: {
            type: 'images',
            imagesCount: 10,
            folder: 'offers/seasons_best',
            fields: 'seasons_best',
            translations: {
                hy: {
                    title: 'üéÅ ’ç’•’¶’∏’∂’´ ’¨’°’æ’°’£’∏÷Ç’µ’∂’∂’•÷Ä’®',
                    description: `’Ö’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’ø’°÷Ä’´ ’¥’•’∂÷Ñ ’Ω’ø’•’≤’Æ’∏÷Ç’¥ ’•’∂÷Ñ ’∂’∏÷Ä, ’ø’∏’∂’°’Ø’°’∂ ÷á ’Ω’´÷Ä’∏’æ ’¨’´ ’≠’°’≤’°’¨’´÷Ñ’∂’•÷Ä, ’∏÷Ä’∏’∂÷Ñ ’°÷Ä’°’£ ’§’°’º’∂’∏÷Ç’¥ ’•’∂ ’Ω’•’¶’∏’∂’´ ’Ω’´÷Ä’•’¨’´’∂’•÷Ä÷â

‘±’µ’Ω ’¢’°’™’∂’∏÷Ç’¥ ’Ø’£’ø’∂’•÷Ñ ’¥’•÷Ä ’°’¥’•’∂’°’©’°÷Ä’¥, ’∫’°’∞’°’∂’ª’æ’°’Æ ÷á ’∏’£’•’∑’∂’π’∏’≤ ’≠’°’≤’°’¨’´÷Ñ’∂’•÷Ä’®’ù ’∫’°’ø÷Ä’°’Ω’ø’æ’°’Æ ’¢’°÷Ä’±÷Ä’∏÷Ä’°’Ø ÷É’°’µ’ø’´÷Å ÷á ’æ’°’º ’£’∏÷Ç’µ’∂’•÷Ä’∏’æ÷â

’Ä’°’Ω÷Å÷Ä’•÷Ñ ’®’∂’ø÷Ä’•’¨ ’±’•÷Ä ’Ω’´÷Ä’•’¨’´ ’ø’°÷Ä’¢’•÷Ä’°’Ø’∂’•÷Ä’®, ÷Ñ’°’∂’´ ’§’•’º ’§÷Ä’°’∂÷Ñ ’∞’°’Ω’°’∂’•’¨’´ ’•’∂, ÷á ’¶’°÷Ä’§’°÷Ä’•÷Ñ ’±’•÷Ä ’ø’∏’∂’® ’¥’•’¶ ’∞’•’ø ’¥’´’°’Ω’´’∂ ‚ú®

‘±’µ’Ω ’Ω’•’¶’∏’∂’´ ’¨’°’æ’°’£’∏÷Ç’µ’∂’∂’•÷Ä’® ’°’µ’Ω’ø’•’≤ ’•’∂’ù ’ø’°÷Ñ’∏÷Ç’©’µ’°’∂, ’∏’≥’´ ÷á ’µ’∏÷Ç÷Ä’°’∞’°’ø’Ø’∏÷Ç’©’µ’°’∂ ’¥’´’°’≠’°’º’∂’¥’°’¥’¢÷â`
                },
                en: {
                    title: 'üéÅ Season‚Äôs Best',
                    description: `Every year we create new, festive, and love-filled ornaments that quickly become seasonal favorites.

Here you‚Äôll find our freshest, most popular, and inspiring wooden creations‚Äîcrafted from high-quality wood and painted in bright colors.

Choose your favorites while they‚Äôre available and make your celebration shine ‚ú®

The best of the season is here‚Äîa blend of warmth, style, and uniqueness.`
                },
                ru: {
                    title: 'üéÅ –õ—É—á—à–µ–µ —Å–µ–∑–æ–Ω–∞',
                    description: `–ö–∞–∂–¥—ã–π –≥–æ–¥ –º—ã —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–µ, –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ª—é–±–æ–≤—å—é –∏–≥—Ä—É—à–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã—Å—Ç—Ä–æ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Ñ–∞–≤–æ—Ä–∏—Ç–∞–º–∏ —Å–µ–∑–æ–Ω–∞.

–ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥—ë—Ç–µ —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ, –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã–µ –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–µ –∏–∑–¥–µ–ª–∏—è –∏–∑ –¥–µ—Ä–µ–≤–∞ ‚Äî –∏–∑ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∏ —è—Ä–∫–∏—Ö –∫—Ä–∞—Å–æ–∫.

–£—Å–ø–µ–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Å–≤–æ–∏ –ª—é–±–∏–º—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –ø–æ–∫–∞ –æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã, –∏ –æ—Ç–ø—Ä–∞–∑–¥–Ω—É–π—Ç–µ –≤–º–µ—Å—Ç–µ —Å –Ω–∞–º–∏ ‚ú®

–õ—É—á—à–µ–µ —ç—Ç–æ–≥–æ —Å–µ–∑–æ–Ω–∞ ‚Äî —ç—Ç–æ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Ç–µ–ø–ª–∞, —Å—Ç–∏–ª—è –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏.`
                }
            }
        }
    };

    const offerType = '{{ offer_type }}' || 'my_classroom';
    const offer = offerData[offerType];

    document.getElementById('offerTitle').textContent = offer.translations[currentLang].title;
    document.getElementById('offerDescription').textContent = offer.translations[currentLang].description;

    let selectedProducts = [];
    let selectedImages = [];
    let products = [];

    // Load products or images based on offer type
    async function loadCatalog() {
        if (offer.type === 'products') {
            try {
                const response = await fetch(`/api/products?lang=${currentLang}&type=all`);
                products = await response.json();
                renderProducts();
            } catch (error) {
                console.error('Error loading products:', error);
            }
        } else if (offer.type === 'images') {
            renderImageGallery();
        }
    }

    function renderProducts() {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = '';

        products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.setAttribute('data-product-id', product.id);
            card.innerHTML = `
            <div class="select-indicator">‚úì</div>
            <div class="card-top">
                <img src="{{BASE_PREFIX}}${product.images_url_list[0]}" alt="${product.name}" class="product-image">
                <div class="product-info">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${product.price} ÷è</div>
                </div>
            </div>
        `;

            card.addEventListener('click', () => toggleProductSelection(product, card));
            grid.appendChild(card);
        });
    }

    function toggleProductSelection(product, card) {
        const index = selectedProducts.findIndex(p => p.id === product.id);

        if (index > -1) {
            selectedProducts.splice(index, 1);
            card.classList.remove('selected');
        } else {
            selectedProducts.push(product);
            card.classList.add('selected');
        }

        updateSelectedProductsList();
    }

    function updateSelectedProductsList() {
        const list = document.getElementById('selectedProductsList');
        const content = document.getElementById('selectedProductsContent');

        if (selectedProducts.length > 0) {
            list.style.display = 'block';
            content.innerHTML = selectedProducts.map(p => `
            <div class="selected-product-item">
                <span>${p.name}</span>
                <span>${p.price} ÷è</span>
            </div>
        `).join('');
        } else {
            list.style.display = 'none';
        }
    }

    function renderImageGallery() {
        document.getElementById('productGrid').style.display = 'none';
        const gallery = document.getElementById('imageGallery');
        gallery.style.display = 'grid';
        document.getElementById('catalogTitle').textContent = '‘∏’∂’ø÷Ä’•÷Ñ ’∂’Ø’°÷Ä’∂’•÷Ä';

        const imageCount = offer.imagesCount;
        for (let i = 1; i <= imageCount; i++) {
            const img = document.createElement('img');
            img.src = `{{BASE_PREFIX}}/static/images/${offer.folder}/${i}.jpg`;
            img.className = 'gallery-image';
            img.setAttribute('data-image-id', i);

            img.addEventListener('click', () => {
                const imageId = i;
                const index = selectedImages.indexOf(imageId);

                if (index > -1) {
                    selectedImages.splice(index, 1);
                    img.classList.remove('selected');
                } else {
                    selectedImages.push(imageId);
                    img.classList.add('selected');
                }
            });

            gallery.appendChild(img);
        }
    }

    // Render form based on offer type
    function renderForm() {
        const form = document.getElementById('orderForm');
        let formHTML = '';

        if (offer.fields === 'my_classroom') {
            formHTML = `
            <div class="form-group">
                <label class="form-label">‘¥’∫÷Ä’∏÷Å’´ ’°’∂’∏÷Ç’∂ <span class="required">*</span></label>
                <input type="text" name="school_name" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">‘¥’°’Ω’°÷Ä’°’∂’´ ’∞’°’¥’°÷Ä <span class="required">*</span></label>
                <input type="text" name="class_number" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">‘±’∑’°’Ø’•÷Ä’ø’∂’•÷Ä’´ ÷Ñ’°’∂’°’Ø <span class="required">*</span></label>
                <input type="number" name="student_count" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">’è’≤’°’∂’•÷Ä’´/’°’≤’ª’´’Ø’∂’•÷Ä’´ ÷Ñ’°’∂’°’Ø</label>
                <input type="text" name="boys_girls" class="form-input" placeholder="’ï÷Ä’´’∂’°’Ø: 15 ’ø’≤’° / 12 ’°’≤’ª’´’Ø">
            </div>
            <div class="form-checkbox">
                <input type="checkbox" id="nominal" name="nominal">
                <label for="nominal">‘±’∂’æ’°’∂’°’Ø’°’∂ (’°’∂’∏÷Ç’∂’∂’•÷Ä’´ ’∞’•’ø)</label>
            </div>
            <div id="namesContainer" class="names-container">
                <label class="form-label">‘±’∑’°’Ø’•÷Ä’ø’∂’•÷Ä’´ ’°’∂’∏÷Ç’∂’∂’•÷Ä</label>
                <div id="namesList"></div>
                <button type="button" class="add-name-btn" onclick="addNameField()">+ ‘±’æ’•’¨’°÷Å’∂’•’¨ ’°’∂’∏÷Ç’∂</button>
            </div>
            <div class="form-group">
                <label class="form-label">’ì’°’©’•’©’°’æ’∏÷Ä’¥’°’∂ ’ø’•’Ω’°’Ø <span class="required">*</span></label>
                <select name="packaging" class="form-select" required>
                    <option value="">‘∏’∂’ø÷Ä’•’¨</option>
                    <option value="bag">’è’∏’∫÷Ä’°’Ø’∏÷Ç’¥</option>
                    <option value="box">’è’∏÷Ç÷É’∏÷Ç’¥</option>
                    <option value="none">‘±’º’°’∂÷Å ÷É’°’©’•’©’°’æ’∏÷Ä’¥’°’∂</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">‘±’µ’¨ ’∂’∑’∏÷Ç’¥’∂’•÷Ä</label>
                <textarea name="notes" class="form-textarea" placeholder="’Ü’Ø’°÷Ä’°’£÷Ä’•÷Ñ ’±’•÷Ä ÷Å’°’∂’Ø’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’® ’¥’°’∂÷Ä’°’¥’°’Ω’∂..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">’Å’•÷Ä ’°’∂’∏÷Ç’∂’® <span class="required">*</span></label>
                <input type="text" name="customer_name" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">’Ä’•’º’°’≠’∏’Ω <span class="required">*</span></label>
                <input type="tel" name="customer_phone" class="form-input" placeholder="+374 XX XXX XXX" required>
            </div>
            <div class="form-group">
                <label class="form-label">‘±’Ø’∂’Ø’°’¨’æ’∏’≤ ’°’º’°÷Ñ’¥’°’∂ ’°’¥’Ω’°’©’´’æ</label>
                <input type="date" name="delivery_date" class="form-input">
            </div>
        `;
        } else if (offer.fields === 'corporate') {
            formHTML = `
            <div class="form-group">
                <label class="form-label">‘≤÷Ä’•’∂’§’´ ’°’∂’∏÷Ç’∂ <span class="required">*</span></label>
                <input type="text" name="brand_name" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">‘Ω’°’≤’°’¨’´÷Ñ’´ ’ø’•’Ω’°’Ø <span class="required">*</span></label>
                <select name="toy_type" class="form-select" required>
                    <option value="">‘∏’∂’ø÷Ä’•’¨</option>
                    <option value="your_brand">’Å’•÷Ä ’¢÷Ä’•’∂’§’∏’æ</option>
                    <option value="our_range">’Ñ’•÷Ä ’ø’•’Ω’°’Ø’°’∂’∏÷Ç÷Å</option>
                    <option value="mixed">’Ñ’•÷Ä ’ø’•’Ω’°’Ø’°’∂’∏÷Ç÷Å ’±’•÷Ä ’¢÷Ä’•’∂’§’∏’æ</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">’î’°’∂’°’Ø <span class="required">*</span></label>
                <input type="number" name="count" class="form-input" required>
            </div>
            <div class="form-checkbox">
                <input type="checkbox" id="nominal" name="nominal">
                <label for="nominal">‘±’∂’æ’°’∂’°’Ø’°’∂ (’°’∂’∏÷Ç’∂’∂’•÷Ä’´ ’∞’•’ø)</label>
            </div>
            <div id="namesContainer" class="names-container">
                <label class="form-label">‘±’∑’≠’°’ø’°’Ø’´÷Å’∂’•÷Ä’´ ’°’∂’∏÷Ç’∂’∂’•÷Ä</label>
                <div id="namesList"></div>
                <button type="button" class="add-name-btn" onclick="addNameField()">+ ‘±’æ’•’¨’°÷Å’∂’•’¨ ’°’∂’∏÷Ç’∂</button>
            </div>
            <div class="form-group">
                <label class="form-label">’ì’°’©’•’©’°’æ’∏÷Ä’¥’°’∂ ’ø’•’Ω’°’Ø <span class="required">*</span></label>
                <select name="packaging" class="form-select" required>
                    <option value="">‘∏’∂’ø÷Ä’•’¨</option>
                    <option value="bag">’è’∏’∫÷Ä’°’Ø’∏÷Ç’¥</option>
                    <option value="box">’è’∏÷Ç÷É’∏÷Ç’¥</option>
                    <option value="none">‘±’º’°’∂÷Å ÷É’°’©’•’©’°’æ’∏÷Ä’¥’°’∂</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">‘±’µ’¨ ’∂’∑’∏÷Ç’¥’∂’•÷Ä</label>
                <textarea name="notes" class="form-textarea" placeholder="’Ü’Ø’°÷Ä’°’£÷Ä’•÷Ñ ’±’•÷Ä ÷Å’°’∂’Ø’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’® ’¥’°’∂÷Ä’°’¥’°’Ω’∂..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">’Å’•÷Ä ’°’∂’∏÷Ç’∂’® <span class="required">*</span></label>
                <input type="text" name="customer_name" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">’Ä’•’º’°’≠’∏’Ω <span class="required">*</span></label>
                <input type="tel" name="customer_phone" class="form-input" placeholder="+374 XX XXX XXX" required>
            </div>
            <div class="form-group">
                <label class="form-label">‘±’Ø’∂’Ø’°’¨’æ’∏’≤ ’°’º’°÷Ñ’¥’°’∂ ’°’¥’Ω’°’©’´’æ</label>
                <input type="date" name="delivery_date" class="form-input">
            </div>
        `;
        } else if (offer.fields === 'special_for_you') {
            formHTML = `
            <div class="form-group">
                <label class="form-label">’î’°’∂’°’Ø <span class="required">*</span></label>
                <input type="number" name="count" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">‘±’∂’∏÷Ç’∂’∂’•÷Ä <span class="required">*</span></label>
                <div id="namesList"></div>
                <button type="button" class="add-name-btn" onclick="addNameField()">+ ‘±’æ’•’¨’°÷Å’∂’•’¨ ’°’∂’∏÷Ç’∂</button>
            </div>
            <div class="form-group">
                <label class="form-label">’ì’°’©’•’©’°’æ’∏÷Ä’¥’°’∂ ’ø’•’Ω’°’Ø <span class="required">*</span></label>
                <select name="packaging" class="form-select" required>
                    <option value="">‘∏’∂’ø÷Ä’•’¨</option>
                    <option value="bag">’è’∏’∫÷Ä’°’Ø’∏÷Ç’¥</option>
                    <option value="box">’è’∏÷Ç÷É’∏÷Ç’¥</option>
                    <option value="none">‘±’º’°’∂÷Å ÷É’°’©’•’©’°’æ’∏÷Ä’¥’°’∂</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">‘±’µ’¨ ’∂’∑’∏÷Ç’¥’∂’•÷Ä</label>
                <textarea name="notes" class="form-textarea" placeholder="’Ü’Ø’°÷Ä’°’£÷Ä’•÷Ñ ’±’•÷Ä ÷Å’°’∂’Ø’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’® ’¥’°’∂÷Ä’°’¥’°’Ω’∂..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">’Å’•÷Ä ’°’∂’∏÷Ç’∂’® <span class="required">*</span></label>
                <input type="text" name="customer_name" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">’Ä’•’º’°’≠’∏’Ω <span class="required">*</span></label>
                <input type="tel" name="customer_phone" class="form-input" placeholder="+374 XX XXX XXX" required>
            </div>
            <div class="form-group">
                <label class="form-label">‘±’Ø’∂’Ø’°’¨’æ’∏’≤ ’°’º’°÷Ñ’¥’°’∂ ’°’¥’Ω’°’©’´’æ</label>
                <input type="date" name="delivery_date" class="form-input">
            </div>
        `;
        } else if (offer.fields === 'christmas_together' || offer.fields === 'seasons_best') {
            formHTML = `
            <div class="form-checkbox">
                <input type="checkbox" id="nominal" name="nominal">
                <label data-translate="form.nominal">Nominal (with names)</label>
            </div>
            <div id="namesContainer" class="names-container">
                <label data-translate="form.names" class="form-label">Names</label>
                <div id="namesList"></div>
                <button data-translate="form.add_name" type="button" class="add-name-btn" onclick="addNameField()">+ ‘±’æ’•’¨’°÷Å’∂’•’¨ ’°’∂’∏÷Ç’∂</button>
            </div>
            <div class="form-group">
                <label data-translate="form.packaging" class="form-label">’ì’°’©’•’©’°’æ’∏÷Ä’¥’°’∂ ’ø’•’Ω’°’Ø <span class="required">*</span></label>
                <select name="packaging" class="form-select" required>
                    <option data-translate="form.packaging.bag" value="bag">’è’∏’∫÷Ä’°’Ø’∏÷Ç’¥</option>
                    <option data-translate="form.packaging.box" value="box">’è’∏÷Ç÷É’∏÷Ç’¥</option>
                    <option data-translate="form.packaging.none" value="none">‘±’º’°’∂÷Å ÷É’°’©’•’©’°’æ’∏÷Ä’¥’°’∂</option>
                </select>
            </div>
            <div class="form-group">
                <label data-translate="form.notes" class="form-label">‘±’µ’¨ ’∂’∑’∏÷Ç’¥’∂’•÷Ä</label>
                <textarea name="notes" class="form-textarea" placeholder="’Ü’Ø’°÷Ä’°’£÷Ä’•÷Ñ ’±’•÷Ä ÷Å’°’∂’Ø’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’® ’¥’°’∂÷Ä’°’¥’°’Ω’∂..."></textarea>
            </div>
            <div class="form-group">
                <label data-translate="form.customer_name" class="form-label">’Å’•÷Ä ’°’∂’∏÷Ç’∂’® <span class="required">*</span></label>
                <input type="text" name="customer_name" class="form-input" required>
            </div>
            <div class="form-group">
                <label data-translate="form.customer_phone" class="form-label">’Ä’•’º’°’≠’∏’Ω <span class="required">*</span></label>
                <input type="tel" name="customer_phone" class="form-input" placeholder="+374 XX XXX XXX" required>
            </div>
            <div class="form-group">
                <label data-translate="form.delivery_date" class="form-label">‘±’Ø’∂’Ø’°’¨’æ’∏’≤ ’°’º’°÷Ñ’¥’°’∂ ’°’¥’Ω’°’©’´’æ</label>
                <input type="date" name="delivery_date" class="form-input">
            </div>
        `;
        }

        formHTML += '<button data-translate="form.submit" type="submit" class="submit-btn" id="submitBtn">üéÅ ’à÷Ç’≤’°÷Ä’Ø’•’¨ ’∫’°’ø’æ’•÷Ä’®</button>';
        form.innerHTML = formHTML;

        // Setup nominal checkbox handler
        const nominalCheckbox = document.getElementById('nominal');
        if (nominalCheckbox) {
            nominalCheckbox.addEventListener('change', (e) => {
                const namesContainer = document.getElementById('namesContainer');
                if (e.target.checked) {
                    namesContainer.classList.add('show');
                    if (offer.fields === 'special_for_you') {
                        addNameField();
                    }
                } else {
                    namesContainer.classList.remove('show');
                }
            });
        }

        // For special_for_you offer, always show names
        if (offer.fields === 'special_for_you') {
            addNameField();
        }

        // Form submission
        form.addEventListener('submit', handleFormSubmit);
    }

    let nameCounter = 0;

    function addNameField() {
        const namesList = document.getElementById('namesList');
        const nameGroup = document.createElement('div');
        nameGroup.className = 'name-input-group';
        nameGroup.innerHTML = `
        <input type="text" name="names[]" class="form-input" placeholder="‘±’∂’∏÷Ç’∂" required>
        <button type="button" class="remove-name-btn" onclick="removeNameField(this)">‚úï</button>
    `;
        namesList.appendChild(nameGroup);
        nameCounter++;
    }

    function removeNameField(btn) {
        btn.parentElement.remove();
    }

    async function handleFormSubmit(e) {
        e.preventDefault();

        const submitBtn = document.getElementById('submitBtn');
        const formMessage = document.getElementById('formMessage');

        // Validate product/image selection for product-based offers
        if (offer.type === 'products' && selectedProducts.length === 0 && offer.fields !== 'corporate') {
            showMessage('‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’®’∂’ø÷Ä’•’¨ ’°’º’∂’æ’°’¶’∂ ’¥’•’Ø ’°’∫÷Ä’°’∂÷Ñ', 'error');
            return;
        }

        if (offer.type === 'images' && selectedImages.length === 0) {
            showMessage('‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’®’∂’ø÷Ä’•’¨ ’°’º’∂’æ’°’¶’∂ ’¥’•’Ø ’∂’Ø’°÷Ä', 'error');
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = '‚è≥ ’à÷Ç’≤’°÷Ä’Ø’æ’∏÷Ç’¥ ’ß...';

        const formData = new FormData(e.target);
        const data = {
            offer_type: offerType,
            selected_products: offer.type === 'products' ? selectedProducts.map(p => p.name) : [],
            selected_images: offer.type === 'images' ? selectedImages : []
        };

        // Collect form fields
        for (let [key, value] of formData.entries()) {
            if (key === 'names[]') {
                if (!data.names) data.names = [];
                data.names.push(value);
            } else {
                data[key] = value;
            }
        }

        // Handle checkbox
        data.nominal = document.getElementById('nominal')?.checked || false;

        try {
            const response = await fetch('/api/order_offer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok && result.success) {
                showMessage('‚úÖ ’á’∂’∏÷Ä’∞’°’Ø’°’¨’∏÷Ç’©’µ’∏÷Ç’∂! ’Å’•÷Ä ’∫’°’ø’æ’•÷Ä’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’∏÷Ç’≤’°÷Ä’Ø’æ’•’¨ ’ß÷â ’Ñ’•’∂÷Ñ ’∑’∏÷Ç’ø’∏’æ ’Ø’Ø’°’∫’æ’•’∂÷Ñ ’±’•’¶ ’∞’•’ø÷â', 'success');
                e.target.reset();
                selectedProducts = [];
                selectedImages = [];
                document.querySelectorAll('.product-card.selected').forEach(card => card.classList.remove('selected'));
                document.querySelectorAll('.gallery-image.selected').forEach(img => img.classList.remove('selected'));
                updateSelectedProductsList();
                document.getElementById('namesContainer')?.classList.remove('show');
            } else {
                showMessage('‚ùå ’ç’≠’°’¨ ’ß ’ø’•’≤’´ ’∏÷Ç’∂’•÷Å’•’¨÷â ‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ÷É’∏÷Ä’±’•’¨ ’Ø÷Ä’Ø’´’∂÷â', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showMessage('‚ùå ‘ø’°’∫’´ ’≠’∂’§’´÷Ä÷â ‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’Ω’ø’∏÷Ç’£’•’¨ ’´’∂’ø’•÷Ä’∂’•’ø ’Ø’°’∫’® ÷á ÷É’∏÷Ä’±’•’¨ ’Ø÷Ä’Ø’´’∂÷â', 'error');
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'üéÅ ’à÷Ç’≤’°÷Ä’Ø’•’¨ ’∫’°’ø’æ’•÷Ä’®';
        }
    }

    function showMessage(message, type) {
        const formMessage = document.getElementById('formMessage');
        formMessage.textContent = message;
        formMessage.className = `message ${type} show`;
        setTimeout(() => {
            formMessage.classList.remove('show');
        }, 5000);
    }

    // Snowflake animation
    function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.style.cssText = `
        position: fixed;
        top: -10px;
        left: ${Math.random() * 100}%;
        color: white;
        font-size: 1.5em;
        opacity: 0.8;
        pointer-events: none;
        z-index: 1;
        animation: snowfall ${5 + Math.random() * 5}s linear forwards;
    `;
        snowflake.textContent = ['‚ùÑÔ∏è', '‚ú®', '‚õÑ'][Math.floor(Math.random() * 3)];
        document.getElementById('snowflakes-container').appendChild(snowflake);
        setTimeout(() => snowflake.remove(), 10000);
    }

    const style = document.createElement('style');
    style.textContent = `
    @keyframes snowfall {
        0% { transform: translateY(-10vh); opacity: 1; }
        100% { transform: translateY(100vh); opacity: 0; }
    }
`;
    document.head.appendChild(style);

    setInterval(createSnowflake, 400);

    // Initialize
    loadCatalog();
    renderForm();
</script>

{% endblock %}